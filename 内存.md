[toc]
# 内存
## 1. 内存分布和设计方式
每个进场都有自己的虚拟空间地址，可以映射到实际的物理内存。虚拟地址->物理地址
分段：虚拟地址里段号和段内偏移地址，通过段表来找到对应物理地址。缺点容易产生内存碎片，和swap分区频繁交换效率低
分页：linux下每页4K，对所有虚拟地址分页，通过页号和页内偏移地址去页表来找到对应物理地址。页表太大 4M
多级分页：利用局部性原理，二三级页表需要的时候才创建，大大节省页表空间
TLB:常访问内存加入
段页式管理： 逻辑段(bss,data,text等)，每段里面再分页
linux内核： 共用内核空间1G，用户空间3G(栈/文件映射(共享内存动态库)/堆/bss/data/text)-- 对内存地址都从0开始，屏蔽了intel cpu段式管理，才有多段式分页管理.
## 2. xy内存池

利用空闲链表的思想，步长为4或8. eg:  步长为4下， 为 4/8/12/16/20/.../8K. 个 空闲链表， 每个空闲链表下都是均等chunk（长度+头部长)。
比如分配11个字节，向上取整到12，到索引值为3的地方 取一块chunk(12字节+头部). 如果此处没有，则分配8K均等分12字节。组成chunk链表挂载

节省(一天顶多也就几M)
不同分配池 分配释放问题
头部长度
内存监控默认开启：查看内存泄露问题



## 3. 线上内存问题
1：非法访问
   多次free
   指针分配空间，如结构体内指针,野指针等
   vector等越界访问
   迭代器失效(vector和map)
   字符串\0结尾等 strncpy
   指针判空
2：内存泄露
  基类析构函数虚函数
  new了没有delete
